<?xml version="1.0" encoding="UTF-8"?>
<jube>

  <patternset name="scalasca_pattern">
    <pattern name="sca_comms_p2p" type="int" unit="nb">"comms_p2p": $jube_pat_int</pattern>
    <pattern name="sca_comms_coll" type="int" unit="nb">"comms_coll": $jube_pat_fp</pattern>
    <pattern name="sca_delay_mpi" type="float" unit="s">"delay_mpi": $jube_pat_fp</pattern>
    <pattern name="sca_delay_omp" type="float" unit="s">"delay_omp": $jube_pat_fp</pattern>
    <pattern name="sca_mpi_nxn_completion" type="float" unit="s">"mpi_nxn_completion": $jube_pat_fp</pattern>
    <pattern name="sca_bytes" type="int">"bytes": $jube_pat_int</pattern>
    <pattern name="sca_time" type="float" unit="s">"time": $jube_pat_fp</pattern>
    <pattern name="sca_mpi_point2point" type="float" unit="s">"mpi_point2point": $jube_pat_fp</pattern>
    <pattern name="sca_critical_path" type="float">"critical_path": $jube_pat_fp</pattern>
    <pattern name="sca_critical_path_imbalance" type="float">"critical_path_imbalance": $jube_pat_fp</pattern>
    <pattern name="sca_omp_time" type="float" unit="s">"omp_time": $jube_pat_fp</pattern>
    <pattern name="sca_mpi_collective" type="float" unit="s">"mpi_collective": $jube_pat_fp</pattern>
    <pattern name="sca_mpi" type="float" unit="s">"mpi": $jube_pat_fp</pattern>
    <pattern name="sca_comms_coll_s" mode="python" unit="s" type="float">$sca_mpi_collective + $sca_mpi_nxn_completion</pattern>
    <pattern name="sca_msg_size" mode="python" unit="kB" type="float">$sca_bytes / ($sca_comms_coll + $sca_comms_p2p) / 1000.</pattern>
    <pattern name="sca_ratio_synchro_wait_mpi" mode="python" type="float">$sca_delay_mpi / $sca_mpi * 100 if $sca_mpi > 0 else 0.0</pattern>
    <pattern name="sca_load_imbalance" mode="python" type="float">$sca_critical_path_imbalance / $sca_critical_path * 100 if $sca_critical_path > 0 else 0</pattern>
    <pattern name="sca_ratio_synchro_wait_omp" mode="python" type="float">$sca_delay_omp / $sca_omp_time * 100 if $sca_omp_time > 0 else 0.0</pattern>
  </patternset>

  <result>
    <use>scalasca_analyse</use>
    <table name="result_scalasca" style="pretty" sort="exec_time">
      <column title="P2P_Calls[nb]">sca_comms_p2p</column>
      <column title="Collective_Calls[nb]">sca_comms_coll</column>
      <column format=".2f" title="Message_Size[kB]">sca_msg_size</column>
      <column format=".2f" title="Load_Imbalance_MPI">sca_load_imbalance</column>
      <column title="Collective_Calls[s]" format=".2f">sca_comms_coll_s</column>
      <column format=".2f" title="Total_Time[s]">sca_time</column>
      <column format=".2f" title="P2P_Calls[s]">sca_mpi_point2point</column>
      <column format=".2f" title="Ratio_Synchro_Wait_OpenMP">sca_ratio_synchro_wait_omp</column>
      <column format=".2f" title="Synchro_Wait_MPI[s]">sca_delay_mpi</column>
      <column format=".2f" title="Ratio_Synchro_Wait_MPI">sca_ratio_synchro_wait_mpi</column>
      <column format=".2f" title="Time_MPI[s]">sca_mpi</column>
    </table>
  </result>
</jube>

